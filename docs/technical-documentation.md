# Technical documentation

## Overview

BCODMONT is an OBO style application ontology created using the [Ontology Development Kit \(ODK\)](https://github.com/INCATools/ontology-development-kit). As such it makes use of a variety of features generated by ODK such as ontology imports a standardized makefile and githhub release-generation. 

The **B**CODMO **S**emantic **M**odel \(**BSM**\) is created within BCODMONT and acts as a controlled vocabulary for the BCODMO data managers to annotate data with. 

The BSM is loosely based on the [NERC Vocabulary Server \(NERC-VS\)](https://www.bodc.ac.uk/resources/products/web_services/vocab/) model, but draws from terminology from various ontologies from the [Open Biological and Biomedical Ontology \(OBO\) Foundry](http://www.obofoundry.org/). It can be though of loosely as a hybrid of the two models, bridging them by playing to the strengths of both systems. 

### Modules:

BSM has the following domain specific modules which can be used together in combination to annotate datasets. 

#### Biology

The Biology module consists of several sub-modules [Anatomy](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/biology/anatomy.owl),[ Physiology](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/biology/physiology.owl), Ecology, Biomolecules, and Organism. It is intended to represent the biologically relevant information pertinant to datasets. 

#### Chemistry

The Chemistry module consists of two sub-modules [Compound](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/chemistry/compound.owl) and [Element](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/chemistry/element.owl). The Compound sub-module consists of a set of chemicals that are determined by analysis focusing on a multi-atomic compound, e.g, `nitrate` \(NO3\) or `carbohydrate`. Whereas the Element sub-module consists of chemicals that are determined by analysis focusing on specific elements including isotopes and valence states, e.g. `elemental Nitrogen` or `Nitrogen-15`.

#### Matrix

The Matrix module represents the environmental context from which datasets were collected. It is based on both the NERC Matrix vocabulary as well as the [MIxS](https://gensc.org/mixs/) \(Minimum Informtion about any "x" Sequence\) standards from the Genomic Standards Consortium \(GSC\). BSM's Matrix is divided into four sub-modules which like the MIxS model represent the environmental context data at increasing levels of granularity. The first module [Region](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/matrix/region.owl), describes at the highest level if data were collected from a `polar`, `temperate` or `tropical` region. 

The next three sub-modules draws from terminology from the Environment Ontology \(ENVO\); following the MIxS ENVO annotation framework which includes the use of \(one or more terms\) from each of the, [Biome](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/matrix/biome.owl), [Context](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/matrix/context.owl), and [Material](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/matrix/material.owl) sub-modules. These are analogous to the `broad-scale environmental context`, `local environmental context`, and `environmental medium`, fields used in the MIxS model. In the **Biome** module are terms by which to report which major environmental system from which a sample came, namely an `aquatic`, `marine`, or `terrestrial` biome. 

The **Context** sub-module contains terms by which to describe the local vicinity of a sample which may have a causal influences on data, e.g. if the data were collected from an `esturay` or a  water layer such as the `marine benthic zone`. 

Finally the **Material** sub-module contains terms for environmental or other material or materials that immediately surrounded or comprise samples e.g., `sea water`, `plankton`, or `sediment`.

#### Operational

The [Operational](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/operational/operational.owl) module describes information about sample processing e.g., `filter fractionation size`, sample post-processing e.g.,  `external repository` as well as spatiotemporal sample collection information e.g., `latitude` or `collection date`.

#### Physics

The Physics module is split up into two sub-modules. The first of which, [Characteristic](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/physics/characteristic.owl) consists of terms describing qualities, characteristics or attributes of materials \(both biotic and abiotic\), e.g., the `depth` or `salinity` measured in sea water, or the `color` used to describe an organism or water body. The [Phenomenon](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/physics/phenomenon.owl) module consists of physical phenomena either mesured or believed to have a causal influence on a sample, e.g., `Taylor column` `deep ocean current` or `thunderstorm`. Note at the moment there are some overlapping terms between the Physics Phenonmena and Matrix Context modules this is intential but we may want to contstrain terms like `epilimnion` to only Matrix.  

#### Quantifiers

The [Quantifiers](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/quantifiers/quantifiers.owl) module consists of terms to describe quantitative measurements conducted on samples within datasets, including classes like `concentration`, `length`, or `standard deviation`. Which are to be used in conjunction with terms from other modules. 



## New Term Requests

In the interim stages of the BSM's development we expect there to be many changes made to the model, mostly additions but perhaps also some term replacements or reshuffeling. As such this section serves as a guide for data managers to request new terms to be added to BSM. Once the model is a bit more solidified and the downstream data processing in order, the  process of adding new terms could be taken up by interested Data Mangers. 

For the time being, data managers can do the following to request new terms. 

1\) First navigate to the [bcodmont/issues](https://github.com/BCODMO/bcodmont/issues/new) page. 

2\) Create a new issue describing the requested term. Explain what it is in clear concise language what the missing term is and what **BSM** module you think it should be added to. Make sure for now to tag @kaiiam in the github issue \(untill the model is stablized and others are trained to handle this as well or in place\). 

3\) Make sure to check throughly check through the existing modules in [https://github.com/BCODMO/bcodmont/tree/main/src/ontology/BCODMO\_SM](https://github.com/BCODMO/bcodmont/tree/main/src/ontology/BCODMO_SM). //TODO either add link to web protege versions or other way to visualize these such as the EBI-docker. 

4\) **Optional** Search for appropriate existing terms. Note that when possible BSM uses existing OBO terms to both have greater interoperability with external projects as well as reuse the work of countless people who have contributed to many well-grounded biological and biomedical ontologies. To explore existing OBO ontology terms navigate to the [OLS ontology lookup page](https://www.ebi.ac.uk/ols/index) and type in your term into the search bar. There are many OBO ontologies not all of which are of the same level of quality, therefore it can be a bit confusing to search. See the `Managing Imports` section of `Maintaining BSM`  for a list of the OBO ontologies we are using for BSM. This list is by no means the only OBO ontologies to search for terms in, but it represents a very good place to start. 

5\) **Optional** if you want to go the extra mile check out the following section on perparing new BSM terms for the step by step detailed instructions for adding to modules via the Robot templates by which they are compiled. 

### Preparing new BSM terms

The working versions of the BSM robot templates are currently the google drive sheets \(linked within the _BCO-DMO Semantic Data Project_ trello page. At the moment these are exported down to the [BCODMO\_SM](https://github.com/BCODMO/bcodmont/tree/main/src/ontology/BCODMO_SM) sub-directories e.g., [biology/robot\_templates/anatomy.tsv](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/biology/robot_templates/anatomy.tsv).  However, relying on google sheets as the source of truth better should not to be considered a long term solution. At some point once we've stabilized the system, we will switch to treating the `tsv` files within the `X_module/robot_templates/` to being the source of truth \(place to work from\).

#### Basics about Robot templates

Robot templates are structured as follows, the first row contains `headers`, these are human-readable labels that are not complied by robot. These can be renamed as needed. The second row contains the `templates` which must contain strings formatted as specified in the [Robot template documentation](https://robot.obolibrary.org/template). Please do not change these. All subsequent rows are for the addition of new terms or the modification of existing ones. 

#### BSM Category Headers

At the moment the first several columns contain headers such as `Sub category 1:`. These columns are not complied by the robot templates but are used to visualize the basic parent child hierarchy that is complied when the template is converted to owl. These are not strictly necessary \(and could be removed, however, they can be helpful when adding new terms to the model\). 

#### Ontology IDs

In order for a term \(a row in the spreadsheet\) to be recognized by robot and compiled into owl code, it must have an entry in the `ontology ID` column. This must either include a BCODMO Semantic Model \(BSM\) ID, or an ID from another OBO ontology. BSM terms must start with the prefix `BSM:` and be followed by seven digits e.g., `BSM:0200001`. BSM IDs must be within an appropriate numeric ID range as specified within the [BCODMO\_SM/idranges.owl](https://github.com/BCODMO/bcodmont/blob/main/src/ontology/BCODMO_SM/idranges.owl) file. 

Imported terms from other OBO ontologies such as ENVO, UBERON, GO etc must follow this same formatting, e.g, with imported ENVO terms one must use the prefix `ENVO:` followed by the correct identifier number, e.g. `ENVO:03000102`. This is refereed to as the `curie` ID formatting style. 

#### Labels

In the `label` column, put the primary labels for new or imported terms, e.g., `marsh` or `ice`. BSM follows lower case naming conventions, with exceptions for proper nouns, e.g., `Taylor column` or `WMO blizzard`. In some instances BSM renames terms imported from existing OBO ontologies in order to simplify them. For example, we rename `ENVO:01000811` `nitrogen-oxygen planetary atmosphere` to `atmosphere`.

#### Parent classes

BSM terms and imported terms should make use of the `parent class` relationship. For example if you were adding a new class `ice fog`, you'd add the `parent class` as `fog`.  You can simply type or copy paste the label of an existing term into the `parent class` column.

To discover new OBO terms which might be relevant to use as parent classes, you can browse them from the ENVO from the [EMBL-EBI Ontology Lookup Service](https://www.ebi.ac.uk/ols/ontologies/) \(OLS\). The OLS search can be filtered by ontology, e.g., [https://www.ebi.ac.uk/ols/ontologies/chebi](https://www.ebi.ac.uk/ols/ontologies/chebi), or [https://www.ebi.ac.uk/ols/ontologies/go](https://www.ebi.ac.uk/ols/ontologies/go) etc. 

Additional documentation about how to browse the Environment Ontology \(ENVO\), as well as its contents, can be found at the [navigating ENVO](https://github.com/EnvironmentOntology/envo/wiki/Navigating-ENVO) github wiki page. The navigation page describes how to go about viewing ENVO \(or other OBO ontologies\), as well as what are main hierarchies within ENVO, giving examples of each.

#### Matches

BSM makes use of the SKOS `exact match` and `close match` annotation properties. `exact match` should be used in cases where two semantics are intended to be the same. For example if an OBO term is found or created that can replace a BSM term.`close match` can be used in cases where two semantics maybe the similar but aren't exactly the same representation. For example terms form the [NCI Thesaurus OBO Edition](https://www.ebi.ac.uk/ols/ontologies/ncit) e.g., `NCIT:C12508`.

#### Definitions

Although definitions and other annotation properties are included for imported OBO terms, new BSM terms, are envisioned to eventually be added to appropriate OBO Foundry Ontologies. As such we encourage new BSM terms to make use of OBO conventions for writing definitions. This includes advise people to follow a genus-differentia structure, i.e., `An A is a B that C's`. The genus refers the parent term, and the differentia is that which makes a term different \(or more specific\) than its parent. Doing this also helps to identify parent/child relationships between terms.

For example in ENVO, example they define [land ice mass](http://purl.obolibrary.org/obo/ENVO_01001547) as:

> An ice mass which has formed over land.

Another example, in UBERON, they define [tissue](http://purl.obolibrary.org/obo/UBERON_0000479) as:

> \[A\] multicellular anatomical structure that consists of many cells of one or a few types, arranged in an extracellular matrix such that their long-range organisation is at least partly a repetition of their short-range organisation.

Using a genus-differentia structure helps both to formulate a concise and simple definition as well as determine the appropriate parent class. In cases where there are multiple differentiating factors, they can be written out as a list, for example:

> A blizzard which has 1\) winds of 35 miles per hour \(approximately 56 kilometers per hour\), 2\) lasts for a period of at least three hours, and 3\) occurs in extremely cold temperatures.

For more information about writing ontology definitions please see [this blog post](https://douroucouli.wordpress.com/2019/07/08/ontotip-write-simple-concise-clear-operational-textual-definitions/) written by Dr. Chris Mungall.

#### Comments

In the `comment` column add any supporting information which is relevant to the term but not essential for its definition. As described in the above [blog post](https://douroucouli.wordpress.com/2019/07/08/ontotip-write-simple-concise-clear-operational-textual-definitions/), any information which gets cut out while trying to write a concise genus-differentia style definition can be put into the comment.

#### Editors notes

The `editors note` column serves as a place for ontology developers to make notes about how to better engineer the term or discuss future developments. For new BSM terms this is where one can suggest an an appropriate OBO ontology and possible parent class for such a term.

#### Synonyms

Following OBO common practices, the BSM robot templates contains four types of synonyms: `exact synonym`, `broad synonym`, `narrow synonym`, `related synonym`. These follow SKOS style \(broader or narrow\) conventions. 

Use `exact synonym` for interchangeable term labels, for example `seawater` and `sea water`. 

Use `broad synonym` when a synonym might refer to more than just the term of interest, for example the term `acid rainfall` has `acid rain` as a broad synonym because `acid rain` might refer to more than just the process of acid rainfall. 

When a synonym refers to something more specific than the class label use `narrow synonym`, for example `road` has narrow synonym `highway`. 

If you unsure about a synonym being broader or narrower then use `related synonym`.

#### Cross references

The `cross reference` column provides a generic way to link to other resources such as mappings to other vocabularies. This could for example be used to map BSM terms to \(individual\) terms from the [NERC vocabularies](https://www.bodc.ac.uk/resources/products/web_services/vocab/).

#### BCODMO master parameter

The `BCODMO master parameter` column is used to link BSM terms to the \(previous system the\) BCODMO master parameters, e.g., `http://lod.bco-dmo.org/id/parameter/1982`.

#### Subsets

BSM has both `category subset` and `Entity subset` columns. At the moment the `Entity subset` column is not being used, however the `category subset` is essential for the BSM compilation process. As such the `category subset` must include a module-specific iri such as `http://bcodmo/sm#material` or `http://bcodmo/sm#anatomy`.

#### Columns with multiple entries

Any columns with `SPLIT=|` at the end of the string in the template \(second\) row allow for multiple `|` delimited inputs where each of which is compiled separately. For example adding `boulbie|buran|purga` within the `narrow synonym` column, which has the template `AL oboInOwl:hasNarrowSynonym@en SPLIT=|` will produce three separate narrow synonym annotation properties:

![image](https://user-images.githubusercontent.com/12255688/100488568-008bce00-30dd-11eb-8c83-45324df24f0f.png)









## Maintaining BSM

### Managing Imports

In order to re-use ontology terms form existing OBO ontologies  we need to import them into our repository. Currently BSM makes use of the following ontologies: BFO CHEBI CL COB ENVO GO IAO MS OBI PATO PCO RO STATO and UBERON. 

#### Add new terms to import

In order to import new terms from ontologies we are already importing from we need to do the following:

#### Running all imports

We can run all existing imports from `bcodmont/src/ontology` with the following command: 

```text
./run.sh make all_imports
```

Note when running on linux systems depending on permissions one may need to add `sudo` in front of the above command. 

#### Running individual imports

To re-run an individual ontology \(instead of all imported ontologies\) one can run a command such as the following, where for example the Gene Ontology `go` is the ontology of interest. One would run the following from `bcodmont/src/ontology`: \(note `sudo` maybe required\)

```text
./run.sh make imports/go_import.owl
```



### Import new ontologies

In order to import a new OBO ontology we need to do the following: ... /TODO



